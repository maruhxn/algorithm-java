# 트리
## 최소 공통 조상
: 트리 그래프에서 임의의 두 노드를 선택했을 때, 두 노드가 각각 자신을 포함해 거슬러 올라가면서 부모 노드를 탐색할 때, 처음 공통으로 만나게 되는 부모 노드

### 일반적인 최소 공통 조상 구하기(= 트리 높이가 크지 않을 때)
ex) 4번, 15번 노드의 최소 공통 조상 구하기
1. 루트 노드에서 탐색(DFS or BFS)을 시작해 각 노드의 부모 노드와 깊이를 저장한다.
   - index  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
   - 부모노드 0 1 1 2 2 3 3 4 4  6  6  7  7 11 11
   - 깊   이 1 2 2 3 3 3 3 4 4  4  4  4  4  5  5
2. 선택된 두 노드의 깊이가 다를 경우, 더 깊은 노드의 노드를 부모 노드로 1개씩 올려주면서 같은 깊이로 맞춘다.
   - 이때, 두 노드가 같으면 해당 노드가 최소 공통 조상이므로, 탐색 종료
3. 깊이가 같을 경우, 두 노드 동시에 부모 노드로 올라가면서 두 노드가 같은 노드가 될 때까지 반복
   - 이때, 처음 만나는 노드가 공통 조상이 됨.

=> 이와 같은 방식은, 트리의 높이가 커질 경우 시간 제약 문제 발생 가능..

### 최소 공통 조상 빠르게 구하기
- 핵심: 서로의 깊이를 맞춰 주거나 같아지는 노드를 찾을 때, 기존에 한 단계씩 올려주는 방식에서 `2^K`씩 올라가 비교하는 방식
- => **기존에 자신의 부모 노드만 저장해두던 방식에서 `2^K`번째 위치의 부모 노드까지 저장해두어야 함.**

1. 부모 노드 저장 배열 만들기
   - 점화식: `P[K][N] = P[K-1][P[K-1][N]]`
     - N번 노드의 `2^K`번째 부모의 노드 번호
     - 점화식은 조합 계산과 관련이 있다.
     - N의 `2^K`번째 부모 노드는 N의 `2^K-1`번째 부모 노드의 `2^K-1`번째 부모 노드라는 의미
     - `K`는 `트리의 깊이 > 2^K`를 만족하는 최댓값
   - 초기화된 배열을 바탕으로 K를 0에서부터 1개씩 증가시키면서 나머지 배열을 채운다.
2. 선택된 두 노드의 깊이 맞추기
   - P배열을 이용해 기존에 한 단계씩 맞췄던 깊이를 `2^K` 단위로 넘어가면서 맞춘다.
   - 깊이를 맞추가 위해 더 깊이 있는 노드의 부모 노드를 P 배열을 통해 찾는다
   - 이를 높이 차이가 0이 될 때까지 반복
3. 최소 공통 조상 찾기
   - 공통 조상을 찾는 작업 역시 한 단계씩이 아닌, `2^K` 단위로 점프하면서 맞춘다
   - **K값을 1씩 감소하면서 P 배열을 이용해 최초로 두 노드의 부모가 달라지는 값을 찾는다**
   - 최초로 달라지는 K에 대한 두 노드의 부모 노드를 찾아 이동한다.
   - 이를 K가 0이 될 때까지 반복한다.
   - 반복문이 종료된 후, 이동한 2개의 노드가 같은 노드라면 해당 노드가, 다른 노드라면 바로 위의 부모 노드가 최소 공통 조상이 된다.